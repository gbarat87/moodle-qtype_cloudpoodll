function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("qtype_cloudpoodll/interactivetranscript",["jquery","core/log"],function(a,b){"use strict";b.debug("Interactive Transcript: initialising");return{init:function init(b){var c=b.component,d=b.playerid,e=b.containerid,f=b.cssprefix,g={};g.settings={};if(d&&a("#"+d).length){g.component=c;g.prefix=f;g.player=a("#"+d)[0];g.title=M.util.get_string("transcripttitle",c);this.doPolyfills();var h=this.transcript(g);a("#"+e).append(h.el())}},doPolyfills:function doPolyfills(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c){window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(b){var c=new Date().getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);a=c+d;return e};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(a){clearTimeout(a)};if("function"!=typeof Object.create){Object.create=function(){var a=function(){};return function(b){if(1<arguments.length){throw Error("Second argument not supported")}if("object"!=_typeof(b)){throw TypeError("Argument must be an object")}a.prototype=b;var c=new a;a.prototype=null;return c}}()}if(!Array.prototype.forEach){Array.prototype.forEach=function(a,b){var c,d;if(null==this){throw new TypeError(" this is null or not defined")}var e=Object(this),f=e.length>>>0;if("function"!=typeof a){throw new TypeError(a+" is not a function")}if(1<arguments.length){c=b}d=0;while(d<f){var g;if(d in e){g=e[d];a.call(c,g,d,e)}d++}}}if("document"in self&&!("classList"in document.createElement("_"))){(function(a){if(!("Element"in a)){return}var f=a.Element.prototype,h=Object,b=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},j=Array.prototype.indexOf||function(a){var b=0,c=this.length;for(;b<c;b++){if(b in this&&this[b]===a){return b}}return-1},c=function(a,b){this.name=a;this.code=DOMException[a];this.message=b},k=function(a,b){if(""===b){throw new c("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(b)){throw new c("INVALID_CHARACTER_ERR","String contains an invalid character")}return j.call(a,b)},g=function(a){var c=b.call(a.getAttribute("class")||""),d=c?c.split(/\s+/):[],e=0,f=d.length;for(;e<f;e++){this.push(d[e])}this._updateClassName=function(){a.setAttribute("class",this.toString())}},d=g.prototype=[],e=function(){return new g(this)};c.prototype=Error.prototype;d.item=function(a){return this[a]||null};d.contains=function(a){a+="";return-1!==k(this,a)};d.add=function(){var a=arguments,b=0,c=a.length,d,e=!1;do{d=a[b]+"";if(-1===k(this,d)){this.push(d);e=!0}}while(++b<c);if(e){this._updateClassName()}};d.remove=function(){var a=arguments,b=0,c=a.length,d,e=!1;do{d=a[b]+"";var f=k(this,d);if(-1!==f){this.splice(f,1);e=!0}}while(++b<c);if(e){this._updateClassName()}};d.toggle=function(a,b){a+="";var c=this.contains(a),d=c?!0!==b&&"remove":!1!==b&&"add";if(d){this[d](a)}return!c};d.toString=function(){return this.join(" ")};if(h.defineProperty){var i={get:e,enumerable:!0,configurable:!0};try{h.defineProperty(f,"classList",i)}catch(a){if(-2146823252===a.number){i.enumerable=!1;h.defineProperty(f,"classList",i)}}}else{if(h.prototype.__defineGetter__){f.__defineGetter__("classList",e)}}})(self)}},defaults:{autoscroll:!0,clickArea:"line",showTitle:!0,showTrackSelector:!1,followPlayerTrack:!0,scrollToCenter:!1,stopScrollWhenInUse:!0},utils:{prefix:"transcript",secondsToTime:function secondsToTime(a){var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%60);d=10>d?"0"+d:d;c=0<b&&10>c?"0"+c:c;if(0<b){return b+":"+c+":"+d}return c+":"+d},localize:function localize(a){return a},createEl:function createEl(a,b){b=b||"";var c=document.createElement(a);c.className=b;return c},extend:function extend(a){var b=_typeof(a);if(!("function"===b||"object"===b&&!!a)){return a}for(var c,d,e=1,f=arguments.length;e<f;e++){c=arguments[e];for(d in c){a[d]=c[d]}}return a}},eventEmitter:{handlers_:[],on:function(a,b,c){if("function"==typeof c){this.handlers_.push([a,b,c])}else{throw new TypeError("Callback is not a function.")}},trigger:function(a,b){this.handlers_.forEach(function(c){if(c[0]===a&&c[1]===b){c[2].apply()}})}},scrollerProto:function scrollerProto(a){var b=function(a){var b=this;a.addEventListener("scroll",function(){if(b.isAutoScrolling){b.isAutoScrolling=!1}else{b.userIsScrolling=!0;a.classList.add("is-inuse")}});a.addEventListener("mouseenter",function(){b.mouseIsOverTranscript=!0});a.addEventListener("mouseleave",function(){b.mouseIsOverTranscript=!1;setTimeout(function(){if(!b.mouseIsOverTranscript){b.userIsScrolling=!1;a.classList.remove("is-inuse")}},1e3)})},c=function(a,b,c,d){return b+c*Math.sin(Math.min(1,a/d)*(Math.PI/2))},d=function(a,b,d){var e=Date.now(),f=a.scrollTop,g=this;b=Math.max(0,b);b=Math.min(a.scrollHeight-a.clientHeight,b);var h=b-f,i=function(){var j=Date.now();g.isAutoScrolling=!0;a.scrollTop=c(j-e,f,h,d);if(a.scrollTop!==b){requestAnimationFrame(i,a)}};requestAnimationFrame(i,a)};return{init:function init(a){this.element=a;this.userIsScrolling=!1;this.mouseIsOverTranscript=!0;this.isAutoScrolling=!0;b.call(this,this.element);return this},to:function scrollToElement(b){if(this.canScroll()){var c=b.parentElement,e=c.offsetTop+c.clientHeight,f=b.offsetTop+b.clientHeight,g=b.offsetTop,h=b.offsetTop+b.clientHeight,i=0,j;if(a.settings.scrollToCenter){i=Math.round(c.clientHeight/2-b.clientHeight/2)}if(g<c.scrollTop+i){j=b.offsetTop-i}else if(h>c.scrollTop+c.clientHeight-i){j=f+i}if(j!==void 0&&c.scrollTop!==j){d.call(this,c,j,400)}}},canScroll:function canScroll(){var a=this.element;return a.scrollHeight>a.offsetHeight},inUse:function inUse(){return this.userIsScrolling}}},scroller:function scroller(a,b){return Object.create(this.scrollerProto(b)).init(a)},trackList:function trackList(a){var b;return{get:function get(){var b=[],c,d;a.tracks=a.player.textTracks;for(c=0;c<a.tracks.length;c++){d=a.tracks[c];if("captions"===d.kind||"subtitles"===d.kind){b.push(d)}}return b},active:function active(c){var d,e;for(d=0;d<a.tracks.length;d++){e=a.tracks[d];if("showing"===e.mode){b=e;return e}}return b||c[0]}}},widget:function widget(a){var b=this,c={};c.element={};c.body={};var d=function(a){eventEmitter.trigger(b,a)},e=function(){var c=b.utils.createEl("header",a.prefix+"-header");c.textContent=a.title;return c},f=function(){var c=b.utils.createEl("select",a.prefix+"-selector");a.validTracks.forEach(function(a,b){var d=document.createElement("option");d.value=b;d.textContent=a.label+" ("+a.language+")";c.appendChild(d)});c.addEventListener("change",function(){j(document.querySelector("#"+a.prefix+"-"+a.player.id+" option:checked").value);d("trackchanged")});return c},g=function(b){var c=b.target.classList,d=b.target.getAttribute("data-begin")||b.target.parentElement.getAttribute("data-begin");if(d!==void 0&&null!==d){if("line"===a.settings.clickArea||"timestamp"===a.settings.clickArea&&c.contains(a.prefix+"-timestamp")||"text"===a.settings.clickArea&&c.contains(a.prefix+"-text")){a.player.currentTime=d}}},h=function(d){var e=b.utils.createEl("div",a.prefix+"-line"),f=b.utils.createEl("span",a.prefix+"-timestamp"),g=b.utils.createEl("span",a.prefix+"-text");e.setAttribute("data-begin",d.startTime);e.setAttribute("tabindex",c._options.tabIndex||0);f.textContent=b.utils.secondsToTime(d.startTime);g.innerHTML=d.text;e.appendChild(f);e.appendChild(g);return e},i=function(d){if("object"!==_typeof(d)){d=a.player.textTracks()[d]}var e=b.utils.createEl("div",a.prefix+"-body"),f,j,k=document.createDocumentFragment();if(!d.activeCues){if("showing"!==d.mode){d.mode="hidden"}window.setTimeout(function(){i(d)},100)}else{var l=d.cues;for(j=0;j<l.length;j++){f=h(l[j]);k.appendChild(f)}e.innerHTML="";e.appendChild(k);e.setAttribute("lang",d.language);e.scroll=b.scroller(e,a);e.addEventListener("click",g);c.element.replaceChild(e,c.body);c.body=e}},j=function(a,b){i(a,b)};return{create:function create(d){var g=document.createElement("div");c._options=d;c.element=g;g.setAttribute("id",a.prefix+"-"+a.player.id);if(a.settings.showTitle){var h=e();g.appendChild(h)}if(a.settings.showTrackSelector){var i=f();g.appendChild(i)}c.body=b.utils.createEl("div",a.prefix+"-body");g.appendChild(c.body);j(a.currentTrack);return this},setTrack:j,setCue:function setCue(b){var d,e,f,g,h=c.body.children;for(d=0;d<h.length;d++){e=h[d];f=e.getAttribute("data-begin");if(d<h.length-1){g=h[d+1].getAttribute("data-begin")}else{g=a.player.duration||1/0}if(b>f&&b<g){if(!e.classList.contains("is-active")){e.classList.add("is-active");if(a.settings.autoscroll&&!(a.settings.stopScrollWhenInUse&&c.body.scroll.inUse())){c.body.scroll.to(e)}}}else{e.classList.remove("is-active")}}},el:function el(){return c.element},on:function on(a,c){eventEmitter.on(b,a,c)},trigger:d}},transcript:function transcript(a){var b=this,c=this.defaults;this.utils.prefix="transcript";a.validTracks=this.trackList(a).get();a.currentTrack=this.trackList(a).active(a.validTracks);a.settings=c;a.widget=this.widget(a).create(c);var d=function(){a.widget.setCue(a.player.currentTime)},e=function(){a.currentTrack=b.trackList(a).active(a.validTracks);a.widget.setTrack(a.currentTrack)};if(0<a.validTracks.length){e();a.player.ontimeupdate=d;if(a.settings.followPlayerTrack){a.player.oncaptionstrackchange=e;a.player.onsubtitlestrackchange=e}}else{throw new Error("transcript: No tracks found!")}return{el:function el(){return a.widget.el()},setTrack:a.widget.setTrack}}}});
//# sourceMappingURL=interactivetranscript.min.js.map
