define("qtype_cloudpoodll/cloudpoodllhelper",["jquery","core/log","qtype_cloudpoodll/cloudpoodllloader"],(function($,log,cloudpoodll){return log.debug("cloudpoodll helper: initialising"),{configs:{},init:function(opts){var config={};config.component=opts.component,config.data_id=opts.data_id,config.inputname=opts.inputname,config.transcriber=opts.transcriber,config.uploadstate=!1,config.safesave=opts.safesave;var name=CSS.escape(config.inputname);config.controls={nextpagebtn:$(".submitbtns .mod_quiz-next-nav"),mediaurl:$("input[name="+name+"mediaurl]"),transcript:$("input[name="+name+"transcript]"),answer:$("input[name="+name+"]")},this.configs[config.data_id]=config;var that=this,gspeech="";cloudpoodll.init(config.data_id,(function(evt){var theconfig=that.configs[evt.id];if(theconfig)switch(evt.type){case"recording":if("started"===evt.action){gspeech="";var cpquestionStarted=new CustomEvent("cpquestionStarted",{details:evt});document.dispatchEvent(cpquestionStarted),1==theconfig.safesave&&(theconfig.controls.nextpagebtn.attr("disabled","disabled"),$(window).on("beforeunload",that.preventPrematureLeaving))}break;case"speech":gspeech+="  "+evt.capturedspeech,theconfig.controls.transcript.val(gspeech),theconfig.controls.answer.val(gspeech);break;case"awaitingprocessing":if("posted"!=theconfig.uploadstate){theconfig.controls.mediaurl.val(evt.mediaurl),theconfig.controls.answer.val(evt.mediaurl);var cpquestionUploaded=new CustomEvent("cpquestionUploaded",{details:evt});document.dispatchEvent(cpquestionUploaded),1==theconfig.safesave&&(theconfig.controls.nextpagebtn.removeAttr("disabled","disabled"),$(window).off("beforeunload",that.preventPrematureLeaving))}theconfig.uploadstate="posted";break;case"error":alert("PROBLEM: "+evt.message)}}))},preventPrematureLeaving:function(e){return log.debug("preventPrematureLeaving has been called"),e.preventDefault(),e.returnValue="Your recording has not been uploaded. Cancel to stay on this page."},register_events:function(config){}}}));

//# sourceMappingURL=cloudpoodllhelper.min.js.map