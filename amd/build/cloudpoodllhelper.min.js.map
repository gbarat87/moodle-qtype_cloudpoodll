{"version":3,"sources":["../src/cloudpoodllhelper.js"],"names":["define","$","log","cloudpoodll","debug","configs","init","opts","config","component","data_id","inputname","transcriber","uploadstate","safesave","name","CSS","escape","controls","nextpagebtn","mediaurl","transcript","answer","that","gspeech","evt","theconfig","id","type","action","cpquestionStarted","CustomEvent","details","document","dispatchEvent","attr","capturedspeech","val","cpquestionUploaded","removeAttr","alert","message","register_events"],"mappings":"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","sourcesContent":["define([\"jquery\", \"core/log\", \"qtype_cloudpoodll/cloudpoodllloader\"], function ($, log, cloudpoodll) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug(\"cloudpoodll helper: initialising\");\n\n    return {\n\n        configs: {},\n\n        init: function (opts) {\n            var config ={};\n            config.component = opts[\"component\"];\n            config.data_id = opts[\"data_id\"];\n            config.inputname = opts[\"inputname\"];\n            config.transcriber = opts[\"transcriber\"];\n            config.uploadstate= false;\n            config.safesave = opts[\"safesave\"];\n\n            //register controls\n            var name = CSS.escape(config.inputname);\n            config.controls = {\n                nextpagebtn: $(\".submitbtns .mod_quiz-next-nav\"),\n                mediaurl: $(\"input[name=\" + name + \"mediaurl]\"),\n                transcript: $(\"input[name=\" + name + \"transcript]\"),\n                answer: $(\"input[name=\" + name + \"]\"),\n            };\n            this.configs[config.data_id] = config;\n            var that=this;\n\n            //setup recorder\n            var gspeech = \"\";\n\n            cloudpoodll.init(config.data_id, function (evt) {\n                var theconfig=that.configs[evt.id];\n                //we need to only do our event (not another recorder on this page)\n                if (!theconfig){return;}\n\n                switch (evt.type) {\n                    case \"recording\":\n                        if (evt.action === \"started\") {\n                            gspeech = \"\";\n                            // post a custom event that a filter template might be interested in\n                            var cpquestionStarted = new CustomEvent(\"cpquestionStarted\", {details: evt});\n                            document.dispatchEvent(cpquestionStarted);\n\n                            //if opts safe save\n                            if(theconfig.safesave==1) {\n                                theconfig.controls.nextpagebtn.attr('disabled', 'disabled');\n                            }\n                        }\n                        break;\n                    case \"speech\":\n                        gspeech += \"  \" + evt.capturedspeech;\n                        theconfig.controls.transcript.val(gspeech);\n                        theconfig.controls.answer.val(gspeech);\n                        break;\n                    case \"awaitingprocessing\":\n                        if (theconfig.uploadstate != \"posted\") {\n                            theconfig.controls.mediaurl.val(evt.mediaurl);\n                            theconfig.controls.answer.val(evt.mediaurl);\n\n                            // post a custom event that a filter template might be interested in\n                            var cpquestionUploaded = new CustomEvent(\"cpquestionUploaded\", {details: evt});\n                            document.dispatchEvent(cpquestionUploaded);\n\n                            //if opts safe save\n                            if(theconfig.safesave==1) {\n                                theconfig.controls.nextpagebtn.removeAttr('disabled', 'disabled');\n                            }\n                        }\n                        theconfig.uploadstate = \"posted\";\n                        break;\n                    case \"error\":\n                        alert(\"PROBLEM: \" + evt.message);\n                        break;\n                }\n            }//end of callback function\n\n            );//end of cp init\n\n        },\n\n\n        register_events: function (config) {\n            //nothing here\n        }\n    };//end of return object\n});"],"file":"cloudpoodllhelper.min.js"}